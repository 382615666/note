# 页面优化


## 图片优化

#### 问题
* 兼容性
* 体积过大
* 不同设备显示对应质量的图片

#### 解决方案
```html
    <style>
        .img {
            width: 200px;
        }
    </style>
    <picture>
        <source srcset="https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_600" media="(max/min-width: 600px)">
        <source srcset="https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_1000" media="(max/min-width: 1000px)">
        <source srcset="https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_1400" media="(max/min-width: 1400px)">
        <img src="https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_1000" alt="图片描述" class="img">
    </picture>
```
> picture兼容ie8+，样式不需要额外处理，浏览器缩放宽度的同时能动态切换src。原理：如果第一个source的media条件满足，则忽略后面的source

```html
    // 单个img标签用法
    <img 
        srcset="
            https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_600 600w,
            https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_1000 1000w,
            https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,q_50,w_1400 1400w
        "
        sizes="(min/max-width: 600px) 600px, (min/max-width: 1000px) 1000px, (min/max-width: 1400px) 1400px, 1000w"
        alt="图片描述"
        src="https://bj.bcebos.com/v1/dev-con/17f3a432b9344377a5cfd9c81effd6f2.jpg@f_auto,d_progressive,w_1000,q_50"
    >
```
> srcset具有兼容性问题。应用于img标签的时候，浏览器缩放宽度的时候，不能动态切换src。原理：当sizes的表达式 (min/max-width: 600px) 为真的时候，查找srcset中，最接近600px宽的src。

#### 参考链接

* [picture 元素](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/picture)
* [img 元素](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img)

## 域名解析

#### 问题
* https://bj.bcebos.com 和 http://argo.ejw.cn 可提前解析

#### 解决方案
```html
    <link rel="dns-prefetch" href="//bj.bcebos.com">
    <link rel="preconnect" href="//bj.bcebos.com">
    <link rel="dns-prefetch" href="//argo.ejw.cn">
    <link rel="preconnect" href="//argo.ejw.cn">
```

#### 参考链接
* [Link types: noopener](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/noopener)


## 页面滚动优化

#### 问题
* 监听滚动事件的时候，可能会出现页面卡顿

#### 解决方案
```javascript
    document.addEventListener('scroll', e => {
        // e.preventDefault()
    }, {
        passive: true
    })
```
> 默认情况下，浏览先执行callback，在判断是否阻止默认事件。passive: true 可以提前告诉浏览器不会阻止默认事件，浏览器会另开线程执行默认事件，很大程度上提高性能，移动端效果更佳。

#### 参考链接
* (EventTarget.addEventListener)[https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener]

## 页面安全

#### 问题
* a标签target新开第三方页面存在安全问题。如：页面中的友情链接

#### 解决方案
```html
    <a href="http://www.baidu.com" ref="noopener noreferrer">百度</a>
```
```javascript
    // js解决方案
    const openWindow = window.open('http://www.baidu.com')
    openWindow.opener = null
```
> 默认情况下，可在新开页面window.opener中获取前页面的一些信息。noopener可让window.opener = null，但存在兼容问题。使用noreferrer作为替代方案，去除http头中的referrer属性

#### 参考链接
* [Link types: noopener](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/noopener)

#### 问题
* bootstrap和jquery第三方框架存在安全问题

#### 解决方案
* jquery建议更新至1.9
* bootstrap建议更新至3.4.1

## 标签语义化

#### 问题
* 友情链接ul标签直接子元素存在i标签

#### 解决方案
* 重新调整i标签的布局和样式

## 无用的css和js

##### 问题
* 详情页markdown相关的js、css在首页加载

##### 解决方案
* 将对应的js、css移到详情页加载